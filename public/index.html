<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <title>Simulador BTC</title>

  <style>
    body {
      font-family: Arial;
      background: #111;
      color: #0f0;
      padding: 20px;
      font-size: 18px;
    }

    p {
      font-size: 30px;
      margin: 10px 0;
    }

    button {
      padding: 12px 20px;
      margin: 8px;
      font-size: 16px;
      background: #000;
      color: #0f0;
      border: 1px solid #0f0;
      cursor: pointer;
    }

    button:hover {
      background: #222;
    }

    .historico {
      margin-top: 20px;
      font-size: 30px;
      white-space: pre-line;
      background: #000;
      padding: 15px;
      border: 1px solid #0f0;
      margin-bottom: 20px;
    }

    .saldo-container {
      margin-bottom: 20px;
    }
  </style>
</head>

<body>

  <p>Pre莽o BTC: <span id="price">---</span> USDT</p>

  <div class="saldo-container">
    <p>Saldo BTC: <b id="btc">---</b></p>
    <p>Saldo USDT: <b id="usdt">---</b></p>
  </div>

  <div class="historico">
    <b>Hist贸rico:</b>
    <div id="historico">---</div>
  </div>

  <button onclick="resetarSaldo()"> Reiniciar saldo</button>

  <script>
    async function tick() {
      try {
        const res = await fetch("/api/tick");
        if (!res.ok) throw new Error("Erro ao buscar tick");
        const data = await res.json();

        // Atualiza pre莽os e saldo
        const preco = data.precoBTC || 0;
        const btc = data.saldoBTC || 0;
        const usdt = btc * preco;

        document.getElementById("price").innerText = preco.toFixed(2);
        document.getElementById("btc").innerText = btc.toFixed(6);
        document.getElementById("usdt").innerText = usdt.toFixed(2);

        // Atualiza hist贸rico
        const linhas = [];

        if (data.valorInicial) {
          linhas.push(
            `Inicial: ${formatarData(data.valorInicial.data)} | ` +
            `USDT ${data.valorInicial.usdt.toFixed(2)} | ` +
            `BTC ${data.valorInicial.preco.toFixed(2)}`
          );
        }

        if (data.valorMaximo) {
          linhas.push(
            `M谩ximo:  ${formatarData(data.valorMaximo.data)} | ` +
            `USDT ${data.valorMaximo.usdt.toFixed(2)} | ` +
            `BTC ${data.valorMaximo.preco.toFixed(2)}`
          );
        }

        document.getElementById("historico").innerText =
          linhas.length ? linhas.join("\n") : "---";

      } catch (e) {
        console.error("tick error:", e);
      }
    }

    async function resetarSaldo() {
      if (!confirm("Reiniciar saldo e hist贸rico?")) return;

      try {
        const res = await fetch("/api/reset", { method: "POST" });
        if (!res.ok) throw new Error("Erro ao resetar saldo");
        await tick(); // Atualiza a tela imediatamente ap贸s reset
      } catch (e) {
        console.error("reset error:", e);
      }
    }

function formatarData(dataStr) {
  const d = new Date(dataStr);
  return d.toLocaleString("pt-BR", {
    timeZone: "America/Sao_Paulo",
    day: "2-digit",
    month: "2-digit",
    year: "numeric",
    hour: "2-digit",
    minute: "2-digit",
    second: "2-digit"
  });
}
    // Inicializa
    tick();
    setInterval(tick, 100);
  </script>

</body>

</html>
